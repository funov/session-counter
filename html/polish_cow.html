<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport"
              content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>Polish Cow</title>
        <link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap" rel="stylesheet">
        <style>
            body {
                background: rgb(241, 10, 10);
                background: linear-gradient(90deg, rgb(205, 7, 7) 23%, rgb(255, 0, 251) 83%);
                font-family: 'Do Hyeon', sans-serif;
            }

            h1 {
                text-align: center;
                font-family: 'Do Hyeon', sans-serif;
            }

            #dancingPolishCow {
                display: flex;
                margin: auto;
            }

            .buttons {
			    display: flex;
			    margin: auto;
                padding-top: 50px;
		    }

            .btn {
                display: block;
                border: 1px solid #000000;
                color: black;
                text-decoration: none;
                font-size: 17px;
                padding: 17px 47px;
                letter-spacing: 0.1em;
                width: 238px;
                text-align: center;
                transition: all 0.5s ease;
                margin: auto;
            }

            .statisticsWidget {
                margin: 50px 300px;
                padding: 40px;
                text-align: center;
                display: block;
                color: black;
                background-color: white;
                border-radius: 25px;
            }

            .btn:hover {
                background-color: #ffffff;
                color: #000;
            }
        </style>
    </head>
    <body>
        <div class="mainScreen">
            <h1>Polish Cow</h1>
            <img id="dancingPolishCow" src="https://media.tenor.com/WAFH6TX2VIYAAAAC/polish-cow.gif" alt="dancing cow">
        </div>
        <div class="buttons">
		    <a href="/" class="btn">Back</a>
	    </div>
        <div class="statisticsWidget" id="statisticsWidget">
            <h1>Loading...</h1>
        </div>
        <script type="text/javascript">
            async function sayHi() {
                let date = new Date()
                let response = await fetch('/api/v1/statistics/sessionCount');
                let dateResponse = await fetch(`/api/v1/statistics/sessionCount/${date.getDate()}-${date.getMonth() + 1}-${date.getFullYear()}`)
                let json
                let dateJson

                if (response.ok) {
                    json = await response.json();
                } else {
                    console.log("HTTP Error: " + response.status);
                }

                if (dateResponse.ok) {
                    dateJson = await dateResponse.json();
                } else {
                    console.log("HTTP Error: " + dateResponse.status);
                }

                let statisticsWidget = document.getElementById('statisticsWidget');

                let sessionCountDay = dateJson['sessionCount'][`${date.getDate()}.${date.getMonth() + 1}.${date.getFullYear()}`][window.location.pathname]
                let sessionCountMonth = dateJson['sessionCount'][`${date.getMonth() + 1}.${date.getFullYear()}`][window.location.pathname]
                let sessionCountYear = dateJson['sessionCount'][`${date.getFullYear()}`][window.location.pathname]

                let uniqueSessionCountDay = dateJson['uniqueSessionCount'][`${date.getDate()}.${date.getMonth() + 1}.${date.getFullYear()}`][window.location.pathname]
                let uniqueSessionCountMonth = dateJson['uniqueSessionCount'][`${date.getMonth() + 1}.${date.getFullYear()}`][window.location.pathname]
                let uniqueSessionCountYear = dateJson['uniqueSessionCount'][`${date.getFullYear()}`][window.location.pathname]

                let allSessionCount = json['sessionCount'][window.location.pathname]
                let allUniqueSessionCount = json['uniqueSessionCount'][window.location.pathname]

                statisticsWidget.innerHTML = `<h1>This page session count</h1>
                <h2>All session count</h2>
                <p>Session count = ${allSessionCount}</p>
                <p>Unique session count = ${allUniqueSessionCount}</p>
                <h2>Today session count</h2>
                <p>Session count = ${sessionCountDay}</p>
                <p>Unique session count = ${uniqueSessionCountDay}</p>
                <h2>This month session count</h2>
                <p>Session count = ${sessionCountMonth}</p>
                <p>Unique session count = ${uniqueSessionCountMonth}</p>
                <h2>This year session count</h2>
                <p>Session count = ${sessionCountYear}</p>
                <p>Unique session count = ${uniqueSessionCountYear}</p>`
            }

            setInterval(sayHi, 1000);
        </script>
    </body>
</html>